#!/bin/bash

###### SET SOME VARIABLES ######
WORKINGDIR=$PWD
cd ../
BASEDIR=$PWD
cd $WORKINGDIR
DEFAULT_PHATDIR=$WORKINGDIR/dependencies #/phat_1_2_1
DEFAULT_CXSCINSTALLDIR=$WORKINGDIR/dependencies
DEFAULT_GNUGPP=g++
## FINISHED SETTING ENVIRONMENT VARIABLES ##
#
#
#
#
############### ESTABLISH PHAT ###############
echo -n "Would you like to unarchive phat yes/[no] ?: "
read UNARCHIVEPHAT
echo

case $UNARCHIVEPHAT in yes)
   echo "The default phat_1_2_1 directory is $DEFAULT_PHATDIR"
   echo -n "Press Enter to unarchive (or type a new directory): "
   read PHATDIR
   echo
   if ["$PHATDIR" == ""] 
   then
      PHATDIR=$DEFAULT_PHATDIR
   fi

   echo "unarchiving phat_1_2_1 into $PHATDIR ......." 

   tar -xf packages/phat_1_2_1.tar.gz -C $PHATDIR
   echo
   ;;
*)
   echo -n "Please provide the full path to your installation of phat: "
   echo
   echo -n "For example: $DEFAULT_PHATDIR (press enter if this is where phat is currently installed)"
   echo
   read PHATDIR
   if [ "$PHATDIR" = "" ]
   then
      PHATDIR=$DEFAULT_PHATDIR
   fi
esac
########## FINISHED ESTABLISHING PHAT ########
#
#
#
#
############### ESTABLISH CXSC ###############
echo -n "Would you like to install cxsc yes/[no] ?: "
read INSTALLCXSC
echo 

case $INSTALLCXSC in yes)
   echo "The default cxsc-2-5-4 installation directory is $DEFAULT_CXSCINSTALLDIR"
   echo -n "Press Enter to install (or type a new directory): "
   read CXSCINSTALLDIR
   echo
   if ["$CXSCINSTALLDIR" == ""] 
   then
      CXSCINSTALLDIR=$DEFAULT_CXSCINSTALLDIR
   fi

   echo "cxsc-2-5-4 will be installed into $CXSCINSTALLDIR"

   echo "inflating cxsc into $CXSCINSTALLDIR" 
   tar -xf packages/cxsc-2-5-4_RANVALINSTALL.tar.gz -C $CXSCINSTALLDIR
   echo "running $CXSCINSTALLDIR/cxsc-2-5-4/./install_cxsc  ......."
   cd $CXSCINSTALLDIR/cxsc-2-5-4
   ./install_cxsc
   cd $WORKINGDIR
   echo
;;
*)
   echo -n "Please provide the full path to your installation of cxsc: "
   echo
   echo -n "For example: $DEFAULT_CXSCINSTALLDIR (press enter if this is where cxsc is currently installed)"
   echo
   read CXSCINSTALLDIR
   if [ "$CXSCINSTALLDIR" = "" ]
   then
      CXSCINSTALLDIR=$DEFAULT_CXSCINSTALLDIR
   fi
esac
########## FINISHED ESTABLISHING CXSC ########
#
#
#
#
########## AUTOGENERATE MAKEFILES  ##########
DEFAULT_AUTOGENMAKEFILES=yes
echo -n "Would you like to automatically generate Makefiles [yes]/no ? "
read AUTOGENMAKEFILES
echo


echo -n "Would you like to select a special C++ Compiler-Version?  yes [no] "
read SPECIALGNU

GNUGPP=$DEFAULT_GNUGPP

case $SPECIALGNU in yes)

   echo -n "C++ Compiler name (e.g. g++-4.6, /usr/local/bin/g++-4.6, etc.): "
   read GNUGPP                                                                    
;;
*)
esac

echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
echo "GNUGPP has been set to: $GNUGPP"
echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"

      
      
if [ "$AUTOGENMAKEFILES" == "" ] 
then
   AUTOGENMAKEFILES=$DEFAULT_AUTOGENMAKEFILES
fi

case $AUTOGENMAKEFILES in yes)

   if [ "$CXSCINSTALLDIR" == "" ]
   then
      CXSCINSTALLDIR=$DEFAULT_CXSCINSTALLDIR
   fi
   if [ "$PHATDIR" == "" ]
   then
      PHATDIR=$DEFAULT_PHATDIR
   fi

   CXSCLIBDIR=$CXSCINSTALLDIR/cxsc-2-5-4/lib
   CXSCINCDIR=$CXSCINSTALLDIR/cxsc-2-5-4/include
   PHATINCDIR=$PHATDIR/phat_1_2_1/include
   # there"s a better way!! Use mktemp rather than saving MakePRE !!  # # (Sept 1, 2015 TDS) (wut? TDS Jan, 2016)
   
   ## MakePRE_persistent_homology
   echo "# Makefile for persistent application (auto generated from install script)" > dependencies/autogenerated_during_installation/MakePRE_persistent
   echo "export APPLICATION_INCL_DIR = $WORKINGDIR/src/persistent_homology" >> dependencies/autogenerated_during_installation/MakePRE_persistent
   echo "export CXSCINCDIR = $CXSCINSTALLDIR/cxsc-2-5-4/include">> dependencies/autogenerated_during_installation/MakePRE_persistent
   echo "export CXSCLIBDIR = $CXSCINSTALLDIR/cxsc-2-5-4/lib"    >> dependencies/autogenerated_during_installation/MakePRE_persistent
   echo "export PHATINCDIR = $PHATDIR/phat_1_2_1/include"       >> dependencies/autogenerated_during_installation/MakePRE_persistent
  
   echo 'CXXINC   = -I$(CXSCINCDIR) -I$(PHATINCDIR) -I$(APPLICATION_INCL_DIR)'>> dependencies/autogenerated_during_installation/MakePRE_persistent
   echo 'LIBPATHS = -L$(CXSCLIBDIR)' >> dependencies/autogenerated_during_installation/MakePRE_persistent 
   echo 'CXXFLAGS =  -O3 $(CXXINC)' >> dependencies/autogenerated_during_installation/MakePRE_persistent 
   echo "CXX      =   $GNUGPP" >> dependencies/autogenerated_during_installation/MakePRE_persistent

   echo "export PYTHON_INCL  = $WORKINGDIR/include/python" >> dependencies/autogenerated_during_installation/MakePRE_persistent  
   echo "export PYTHON_CLEAN = $WORKINGDIR/include/python" >> dependencies/autogenerated_during_installation/MakePRE_persistent

   cp dependencies/autogenerated_during_installation/MakePRE_persistent src/persistent_homology/MakePRE
   
   cat src/persistent_homology/MakePOST     >> src/persistent_homology/MakePRE

   echo "-----------------------------------------------------------"
   echo "-----------------------------------------------------------"
   echo
   echo -n "A Makefile using the directories specified during this
   installation has been created."
   echo 
   echo
   echo "-----------------------------------------------------------"
   echo
   echo -n "Now that you've read the README file and verified phat and
   cxsc installations, navigate to the application directories and have a look around."
   echo
   echo
   echo "-----------------------------------------------------------"
   echo "-----------------------------------------------------------"


   cd src/persistent_homology
   cp MakePRE Makefile
   
   cd $WORKINGDIR
;; 
*)
esac
###### END AUTOGENERATE MAKEFILES  ##########
